---
title: "Using the usheR student pairing package"
author: "Nicola Burns"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Using the usheR student pairing package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


# Introduciton 

This vignette walks through how to use the full suite of functions in the **`usheR` package**. It is designed from the perspective of an instructor managing live, in-person, or online teaching sessions, with a focus on:

* Tracking attendance on a weekly/sessional basis
* Automatically generating fair, rotating student pairs or small groups
* Minimising repeated student pairings or groups across sessions
* Saving attendance and pairings data to `.csv` files for future reference

This package is ideal for any setting where students regularly complete peer or collaborative exercises, and the instructor wishes to ensure **everyone works with a variety of peers over time**. 

## What this package helps you do

### Track who is present each session
Use `take_attendance()` to mark which students are present. You can optionally save this data to an attendance file that builds up each week.

### Automatically generate student pairs (or small groups)
Use `student_pairs()` to generate optimal groupings based on which students are present. The function minimises **duplicate pairs** from previous sessions.

### Save a full pairing history
You can export the weekly pairings to a `.csv` file using the `file_path` argument or convert them to a tidy format using `convert_to_df()`.

## Output files created by the package

This package can produce and optionally save two main types of output:

1. **Attendance file**
Generated by the `take_attendance()` function
- Tracks which students were present each week
- Can be appended to week after week  
- Useful for monitoring which students are present or absent each week, and for generating attendance reports

2. **Pairs file**
Generated by the `student_pairs()` function
- Tracks which students were grouped together each session
- Can be stored across multiple sessions/weeks
- Helps avoid repeating the same pairings until all pairs have been exhausted. 


## Contents
Step 1: Prepare your class list
Step 2: Take attendance
Step 3: Generate student pairs
Step 4: Repeat weekly with pairing history

# Step 1: Prepare your class list

The first thing you need to do is create a **master list of all enrolled students**, or **obtain this list from administration**. 

This master list will act as the reference point for attendance tracking, pairing, and session management throughout the term.

There are two acceptable formats of the master class list:

* Option 1: A **character vector**
* Option 2: A **data frame** with a `name` column.

```{r}
# Option 1: a simple vector of names
class_list <- c("Nicola", "John", "Keith", "Beth", "Audrey", "Hesham", "Polly")
class_list

# Option 2: data frame
class_dataframe <- data.frame(name = class_list)
class_dataframe

# NOTE: most likely, you will read in the master list csv file given to you from admin, in which you will
# class_master <- readr::read_csv("YOUR_LIST.csv")
# This will read in the csv file as a data frame
# Make sure this csv file has a `name` column, otherwise the functions won't work. 
# MAKE SURE THIS MASTER LIST CSV FILE IS SAVED INTO THE DIRECTORY YOU ARE USING FOR YOUR R SESSION, AND WHERE YOUR PAIRS GENERATION SCRIPT IS. 
```

The functions `take_attendance()` and `student_pairs()`, which will be used later on in this tutorial, are both built to handle either list or data frame format, but the **data frame format is strongly recommended** if you plan to track attendance over time and save it as a .csv.

#### Important notes for class lists

* **Names must be unique**. Duplicate names (e.g., two "Alex") will result in confusing (**But not incorrect**) pairing history. Consider adding a last initial or student ID to make names distinct if only first names are given. 

* Names are case-sensitive. "John" and "john" will be treated as two different students.

* If you update your class list mid-semester (e.g., a student joins), add their name to the end of the original list to keep ordering (indexing) consistent.


# Step 2: Take attendance

Once you have prepared your full class list, the next step is to **record who is present** at a given session using the `take_attendance()` function.

This creates a record of attendance, with each student marked as `"present"` or `"absent"`. You can use this record immediately to generate student pairs, and/or save it to a csv file for use later on.

## What does `take_attendance()` actually do?

It takes in:
- A full list of enrolled students (your full class list from **Step 1**)
- A list of which students showed up (present students, indexed by position their on the roster)
- An optional session label (e.g., `"CourseX_Week1"`), but recommended for recording purposes.

It returns:
- A **table** showing who was present or absent in that session. 

And optionally:
- Saves that table to a `.csv` file so you can keep track of attendance over multiple weeks/sessions. 

## Basic usage

You have your master class list from Step 1.

Now suppose four students show up to Week 1: Nicola, John, Beth, and Audrey. These students are in rows 1, 2, 4, and 5 of the data frame.

Here’s how you record that attendance:

```{r}
# Load in the usheR package from your library
# library(usheR)

attendance_week1 <- take_attendance(
  full_class = class_dataframe,
  present_students = c(1, 2, 4, 5),  # the row numbers of students who are present
  session_id = "CourseX_Week1" # this label will show up in the attendance table, as well as the saved csv file (if you choose to save - next part)
)
```

This gives you a data frame like this:

```{r echo = FALSE}
attendance_week1
```

This clearly shows you which students were present and absent in Week 1 of Course X.

### Saving attendance to a file

If you want to save this attendance to a `.csv` file, for example, to build up a full term's worth of attendance records, just add the `file_path` argument to the function:

```{r}
take_attendance(
  full_class = class_dataframe,
  present_students = c(1, 2, 4, 5),
  session_id = "CourseX_Week1",
  file_path = "CourseX_attendance_log.csv"
)
```

This **creates** a file named `CourseX_attendance_log.csv`, in which the file will be saved in your **working directory**.

To check your working directory:

```{r}
getwd()
```

To change your working directory, use `setwd("your/folder/path")` or set it in RStudio using the Session > Set Working Directory menu.

### Adding more sessions to the same file

If you want to add each week’s attendance to the same file, use the `append = TRUE` option:

```{r}
attendance_week2 <- take_attendance(
  full_class = class_dataframe,
  present_students = c(2, 3, 4, 6),
  session_id = "CourseX_Week2",
  file_path = "CourseX_attendance_log.csv",
  append = TRUE)
attendance_week2
```

This will add Week 2’s attendance underneath Week 1’s, keeping everything in one neat file. This is very useful for reporting attendance at the end of the academic year, so it is recommended to append at the end of every session/week (*apart from the first week of course, where there is nothing to append to*). 

### How do I know the row numbers of each student?

Run your master class list name (in this example, run the line below) in the RStudio Console to print the full class list with row numbers:

```{r}
class_dataframe
```

The numbers on the left (1, 2, 3, etc.) are the indices you’ll use in `present_students =`.

If you’re working from a printed attendance sheet or Zoom/Teams student list, just match up names to their row number in your data frame.

### Common mistakes to avoid

| Mistake | Explanation | Fix |
| --------| ----------- | --- |
| Forgetting the `name` column   | `full_class` must be a **data frame with a `name` column** | Use `data.frame(name = class_list)` |
| Using names instead of numbers | `present_students` must be row numbers, **not** names | Use the row index (e.g., `1`, `2`) not `"Nicola"` | 
| Not giving a `session_id`| One will be generated for you (e.g., with date/time), but it’s better to label it | Provide a string like `"CourseX_Week1"` |



# Step 3: generate students pairs 

Once you have taken attendance for a session (Step 2), the next step is to **form pairs or small groups** of the students who are present. This is done using the **`student_pairs()`** function.

This function uses a smart pairing algorithm that tries to **avoid repeating pairs from previous weeks**, so that students work with someone new each time.

You can use it:
- For any number of present students
- With different group sizes (e.g., pairs, trios, groups of 4)
- With or without pairing history from previous sessions (pairing history is needed for subsequent sessions/weeks so no duplicate pairs/groups are given)
- With or without saving to file (need to save the pairs history for subsequent sessions/weeks so no duplicate pairs/groups are given)

## What does `student_pairs()` actually do?

It takes in:
- The attendance data for that session/week (from `take_attendance()` - Step 2)

It optionally takes in:
- Past pairing history (to avoid repeated pairs)
- Group size (e.g., 2 for pairs, 3 for trios, and so on)
- File path (to save the result as a csv file)

It returns:
- A table showing which students were grouped together for that session/week
*(along with week/session and group number)*

It also:
- Tries to minimise repeated groupings

## Basic usage

Taking your attendance output from `take_attendance()` (Step 2), use **`student_pairs()`** to generate groups from the present students.

```{r}
pairings_week1 <- student_pairs(attendance = attendance_week1,
                                group_size = 2) # Group size can be changed to any number
```

This will return a `tibble` (table) with 3 columns:

```{r}
pairings_week1
```

Each group is a row. The `~~` in the pairing column separates the student names in each group.

### Saving to a file

If you want to save these pairings to a `.csv` file (strongly recommended), just add a `file_path`: 

```{r}
student_pairs(attendance = attendance_week1, 
              group_size = 2,
              file_path = "CourseX_week1_pairs.csv")
```

This creates a file in your current working directory called `CourseX_week1_pairs.csv`, with the same columns: `week`, `group`, and `pairing`.

If you do this for each week (e.g., `"CourseX_week2_pairs.csv"`, `"CourseX_week3_pairs.csv"`), you can build a full history of pairings.

### Changing the group size
By default, `student_pairs()` creates pairs (`group_size = 2`). But you can change this:

```{r}
student_pairs(attendance = attendance_week1, 
              group_size = 3)
```

This will try to group students into groups of 3 instead of pairs.

**Note**: If the number of present students doesn’t divide evenly (e.g., 7 students in groups of 3), the leftover student is always added to the first group, so that no one is missed out. 

### Using pairing history (optional, but powerful - STRONGLY recommended)

The `student_pairs()` function can take into account who has already been grouped together in previous weeks. This avoids repetition and encourages students to meet someone new each session.

To do this, pass in the previous pairings using the `pair_history` argument. Let's say we are on week 2 of the course:

```{r}
pairings_week2 <- student_pairs(
  attendance = attendance_week2,
  pair_history = pairings_week1)
pairings_week2
```

Behind the scenes, this uses a "fitness function" that scores each new grouping: the fewer repeats from history, the better.

You can use as much history as you like — one week, several weeks, or a full term’s worth.

You can store and reuse this history as a list (`pairings_week1`, `pairings_week2`, etc.). 

# Step 4: repeat across sessions

Track attendance and avoid repeat pairs by using previous results as history.

```{r}
attendance_week2 <- take_attendance(
  full_class = class_dataframe,
  present_students = c(2, 3, 5, 6),
  session_id = "Week_2"
)
attendance_week2

pairings_week2 <- student_pairs(
  attendance = attendance_week2,
  pair_history = pairings_week1
)
pairings_week2
```

## Example: multiple weeks

For this example, we will use the `USJudgeRatings` dataset, which has real names of Judges from the US Superior Court.

*Note this example uses the `file_path` and `append` arguments to simulate real life csv file saving and appending to the same files over weeks. If you don't want to save these csv files onto your own computer, then simply remove the `file_path` and `append` arguments.*

```{r}
# Full class roster
class_list <- data.frame(name = rownames(USJudgeRatings))
class_list

# Week 1
attendance_w1 <- take_attendance(full_class = class_list,
                                 present_students = c(1:6, 7, 9, 13:20), 
                                 session_id = "LawCourse_Week_1",
                                 file_path = "LawCourse_attendance.csv")
attendance_w1

student_pairs_w1 <- student_pairs(attendance = attendance_w1,
                                  group_size = 2,
                                  file_path = "LawCourse_pairs.csv")
student_pairs_w1

# Week 2
attendance_w2 <- take_attendance(class_list, 
                                 c(2:7, 8:11, 28),
                                 session_id = "LawCourse_Week_2",
                                 file_path = "LawCourse_attendance.csv",
                                 append = TRUE)
attendance_w2

student_pairs_w2 <- student_pairs(attendance_w2,
                                  group_size = 3,
                                  pair_history = student_pairs_w1,
                                  file_path = "LawCourse_pairs.csv")
student_pairs_w2

# Week 3
attendance_w3 <- take_attendance(class_list, 
                                 c(1, 4, 5, 8, 10, 15:30), 
                                 session_id = "LawCourse_Week_3",
                                 file_path = "LawCourse_attendance.csv",
                                 append = TRUE)
attendance_w3

student_pairs_w3 <- student_pairs(attendance_w3, 
                                  group_size = 2,
                                  pair_history = student_pairs_w2, 
                                  file_path = "LawCourse_pairs.csv")
student_pairs_w3
```

### Note-wrothy points

* Use `file_path` to save attendance and pairings.
* Pass prior `pairing_history` to avoid group repeats until necessary. 







Vignettes are long form documentation commonly included in packages. Because they are part of the distribution of the package, they need to be as compact as possible. The `html_vignette` output type provides a custom style sheet (and tweaks some options) to ensure that the resulting html is as small as possible. The `html_vignette` format:

- Never uses retina figures
- Has a smaller default figure size
- Uses a custom CSS stylesheet instead of the default Twitter Bootstrap style

## Vignette Info

Note the various macros within the `vignette` section of the metadata block above. These are required in order to instruct R how to build the vignette. Note that you should change the `title` field and the `\VignetteIndexEntry` to match the title of your vignette.

## Styles

The `html_vignette` template includes a basic CSS theme. To override this theme you can specify your own CSS in the document metadata as follows:

    output: 
      rmarkdown::html_vignette:
        css: mystyles.css

## Figures

The figure sizes have been customised so that you can easily put two images side-by-side. 

```{r, fig.show='hold'}
plot(1:10)
plot(10:1)
```

You can enable figure captions by `fig_caption: yes` in YAML:

    output:
      rmarkdown::html_vignette:
        fig_caption: yes

Then you can use the chunk option `fig.cap = "Your figure caption."` in **knitr**.

## More Examples

You can write math expressions, e.g. $Y = X\beta + \epsilon$, footnotes^[A footnote here.], and tables, e.g. using `knitr::kable()`.

```{r, echo=FALSE, results='asis'}
knitr::kable(head(mtcars, 10))
```

Also a quote using `>`:

> "He who gives up [code] safety for [code] speed deserves neither."
([via](https://twitter.com/hadleywickham/status/504368538874703872))
