---
title: "Using the usheR student pairing package"
author: "Nicola Burns"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Using the usheR student pairing package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


# Introduciton 

This vignette walks through how to use the full suite of functions in the **`usheR` package**. It is designed from the perspective of an instructor managing live, in-person, or online teaching sessions, with a focus on:

* Tracking attendance on a weekly/sessional basis
* Automatically generating fair, rotating student pairs or small groups
* Minimising repeated student pairings or groups across sessions
* Saving attendance and pairings data to `.csv` files for future reference

This package is ideal for any setting where students regularly complete peer or collaborative exercises, and the instructor wishes to ensure **everyone works with a variety of peers over time**. 

## What this package helps you do

### Track who is present each session
Use `take_attendance()` to mark which students are present. You can optionally save this data to an attendance file that builds up each week.

### Automatically generate student pairs (or small groups)
Use `student_pairs()` to generate optimal groupings based on which students are present. The function minimises **duplicate pairs** from previous sessions.

### Save a full pairing history
You can export the weekly pairings to a `.csv` file using the `file_path` argument or convert them to a tidy format using `convert_to_df()`.

## Output files created by the package

This package can produce and optionally save two main types of output:

1. **Attendance file**
Generated by the `take_attendance()` function
- Tracks which students were present each week
- Can be appended to week after week  
- Useful for monitoring which students are present or absent each week, and for generating attendance reports

2. **Pairs file**
Generated by the `student_pairs()` function
- Tracks which students were grouped together each session
- Can be stored across multiple sessions/weeks
- Helps avoid repeating the same pairings until all pairs have been exhausted. 


## Contents
Step 1: Prepare your class list
Step 2: Take attendance
Step 3: Generate student pairs
Step 4: Repeat weekly with pairing history

# Step 1: Prepare your class list

The first thing you need to do is create a **master list of all enrolled students**, or **obtain this list from administration**. 

This master list will act as the reference point for attendance tracking, pairing, and session management throughout the term.

There are two acceptable formats of the master class list:

* Option 1: A **character vector**
* Option 2: A **data frame** with a `name` column.

```{r}
# Option 1: a simple vector of names
class_list <- c("Nicola", "John", "Keith", "Beth", "Audrey", "Hesham", "Polly")
class_list

# Option 2: data frame
class_dataframe <- data.frame(name = class_list)
class_dataframe
```

The functions `take_attendance()` and `student_pairs()`, which will be used later on in this tutorial, are both built to handle either list or data frame format, but the **data frame format is strongly recommended** if you plan to track attendance over time and save it as a .csv.

#### Important notes for class lists

* **Names must be unique**. Duplicate names (e.g., two "Alex") will result in confusing or incorrect pairing history. Consider adding a last initial or student ID to make names distinct.

Names are case-sensitive. "John" and "john" will be treated as two different students.

If you update your class list mid-semester (e.g., a student joins), add their name to the end of the original list to keep ordering consistent.


# Step 2: Take attendance

Use **`take_attendance()`** to record which students are present.

```{r}
# Load in the usheR package from your library
# library(usheR)

attendance_week1 <- take_attendance(
  full_class = class_dataframe,
  present_students = c(1, 2, 4, 5),  # Row indices of each student who is present
  session_id = "Week_1"
)
attendance_week1
```

You can also save it:

```{r}
take_attendance(
  full_class = class_dataframe,
  present_students = c(1, 2, 4, 5),
  session_id = "Week_1",
  file_path = "attendance_log.csv"
)
```

# Step 3: generate students pairs 

Use **`student_pairs()`** to form groups from the present students.

```{r}
pairings_week1 <- student_pairs(attendance = attendance_week1)
pairings_week1
```

Optionally save:
```{r}
student_pairs(attendance = attendance_week1, file_path = "week1_pairs.csv")
```

# Step 4: repeat across sessions

Track attendance and avoid repeat pairs by using previous results as history.

```{r}
attendance_week2 <- take_attendance(
  full_class = class_dataframe,
  present_students = c(2, 3, 5, 6),
  session_id = "Week_2"
)
attendance_week2

pairings_week2 <- student_pairs(
  attendance = attendance_week2,
  pair_history = pairings_week1
)
pairings_week2
```

## Example: multiple weeks

For this example, we will use the `USJudgeRatings` dataset, which has real names of Judges from the US Superior Court.

*Note this example uses the `file_path` and `append` arguments to simulate real life csv file saving and appending to the same files over weeks. If you don't want to save these csv files onto your own computer, then simply remove the `file_path` and `append` arguments.*

```{r}
# Full class roster
class_list <- data.frame(name = rownames(USJudgeRatings))
class_list

# Week 1
attendance_w1 <- take_attendance(full_class = class_list,
                                 present_students = c(1:6, 7, 9, 13:20), 
                                 session_id = "LawCourse_Week_1",
                                 file_path = "LawCourse_attendance.csv")
attendance_w1

student_pairs_w1 <- student_pairs(attendance = attendance_w1,
                                  group_size = 2,
                                  file_path = "LawCourse_pairs.csv")
student_pairs_w1

# Week 2
attendance_w2 <- take_attendance(class_list, 
                                 c(2:7, 8:11, 28),
                                 session_id = "LawCourse_Week_2",
                                 file_path = "LawCourse_attendance.csv",
                                 append = TRUE)
attendance_w2

student_pairs_w2 <- student_pairs(attendance_w2,
                                  group_size = 3,
                                  pair_history = student_pairs_w1,
                                  file_path = "LawCourse_pairs.csv")
student_pairs_w2

# Week 3
attendance_w3 <- take_attendance(class_list, 
                                 c(1, 4, 5, 8, 10, 15:30), 
                                 session_id = "LawCourse_Week_3",
                                 file_path = "LawCourse_attendance.csv",
                                 append = TRUE)
attendance_w3

student_pairs_w3 <- student_pairs(attendance_w3, 
                                  group_size = 2,
                                  pair_history = student_pairs_w2, 
                                  file_path = "LawCourse_pairs.csv")
student_pairs_w3
```

### Note-wrothy points

* Use `file_path` to save attendance and pairings.
* Pass prior `pairing_history` to avoid group repeats until necessary. 







Vignettes are long form documentation commonly included in packages. Because they are part of the distribution of the package, they need to be as compact as possible. The `html_vignette` output type provides a custom style sheet (and tweaks some options) to ensure that the resulting html is as small as possible. The `html_vignette` format:

- Never uses retina figures
- Has a smaller default figure size
- Uses a custom CSS stylesheet instead of the default Twitter Bootstrap style

## Vignette Info

Note the various macros within the `vignette` section of the metadata block above. These are required in order to instruct R how to build the vignette. Note that you should change the `title` field and the `\VignetteIndexEntry` to match the title of your vignette.

## Styles

The `html_vignette` template includes a basic CSS theme. To override this theme you can specify your own CSS in the document metadata as follows:

    output: 
      rmarkdown::html_vignette:
        css: mystyles.css

## Figures

The figure sizes have been customised so that you can easily put two images side-by-side. 

```{r, fig.show='hold'}
plot(1:10)
plot(10:1)
```

You can enable figure captions by `fig_caption: yes` in YAML:

    output:
      rmarkdown::html_vignette:
        fig_caption: yes

Then you can use the chunk option `fig.cap = "Your figure caption."` in **knitr**.

## More Examples

You can write math expressions, e.g. $Y = X\beta + \epsilon$, footnotes^[A footnote here.], and tables, e.g. using `knitr::kable()`.

```{r, echo=FALSE, results='asis'}
knitr::kable(head(mtcars, 10))
```

Also a quote using `>`:

> "He who gives up [code] safety for [code] speed deserves neither."
([via](https://twitter.com/hadleywickham/status/504368538874703872))
