---
title: "Using the usheR student pairing package"
author: "Nicola Burns"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Using the usheR student pairing package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r}
library(usheR)
```


# Introduciton 

This vignette walks through how to use the full suite of functions in the __`usheR` package__. It is designed from the perspective of an instructor managing live, in-person, or online teaching sessions, with a focus on:

* Tracking attendance on a weekly/sessional basis
* Automatically generating fair, rotating student pairs or small groups
* Minimising repeated student pairings or groups across sessions
* Saving attendance and pairings data to `.csv` files for future reference

This package is ideal for any setting where students regularly complete peer or collaborative exercises, and the instructor wishes to ensure __everyone works with a variety of peers over time__. 

## What this package helps you do

### Track who is present each session

Use `take_attendance()` to mark which students are present. You can optionally save this data to an attendance file that builds up each week.

### Automatically generate student pairs (or small groups)

Use `student_pairs()` to generate optimal groupings based on which students are present. The function minimises __duplicate pairs__ from previous sessions.

### Save a full pairing history

You can export the weekly pairings to a `.csv` file using the `file_path` argument or convert them to a tidy format using `convert_to_df()`.

## Output files created by the package

This package can produce and optionally save two main types of output:

1. __Attendance file__
Generated by the `take_attendance()` function
- Tracks which students were present each week
- Can be appended to week after week  
- Useful for monitoring which students are present or absent each week, and for generating attendance reports

2. __Pairs file__
Generated by the `student_pairs()` function
- Tracks which students were grouped together each session
- Can be stored across multiple sessions/weeks
- Helps avoid repeating the same pairings until all pairs have been exhausted. 


## Contents

Step 1: Prepare your class list
Step 2: Take attendance
Step 3: Generate student pairs
Step 4: Repeat weekly with pairing history

# Step 1: Prepare your class list

The first thing you need to do is create a __master list of all enrolled students__, or __obtain this list from administration__. 

This master list will act as the reference point for attendance tracking, pairing, and session management throughout the term.

There are two acceptable formats of the master class list:

* Option 1: A __character vector__
* Option 2: A __data frame__ with a `name` column.

```{r}
# Option 1: a simple vector of names
class_list <- c("Nicola", "John", "Keith", "Beth", "Audrey", "Hesham", "Polly")
class_list

# Option 2: data frame
class_dataframe <- data.frame(name = class_list)
class_dataframe

# NOTE: most likely, you will read in the master list csv file given to you from admin, in which you will
# class_master <- readr::read_csv("YOUR_LIST.csv")
# This will read in the csv file as a data frame
# Make sure this csv file has a `name` column, otherwise the functions won't work. 
# MAKE SURE THIS MASTER LIST CSV FILE IS SAVED INTO THE DIRECTORY YOU ARE USING FOR YOUR R SESSION, AND WHERE YOUR PAIRS GENERATION SCRIPT IS. 
```

The functions `take_attendance()` and `student_pairs()`, which will be used later on in this tutorial, are both built to handle either list or data frame format, but the __data frame format is strongly recommended__ if you plan to track attendance over time and save it as a .csv.

#### Important notes for class lists

* __Names must be unique__. Duplicate names (e.g., two "Alex") will result in confusing (__But not incorrect__) pairing history. Consider adding a last initial or student ID to make names distinct if only first names are given. 

* Names are case-sensitive. "John" and "john" will be treated as two different students.

* If you update your class list mid-semester (e.g., a student joins), add their name to the end of the original list to keep ordering (indexing) consistent.


# Step 2: Take attendance

Once you have prepared your full class list, the next step is to __record who is present__ at a given session using the `take_attendance()` function.

This creates a record of attendance, with each student marked as `"present"` or `"absent"`. You can use this record immediately to generate student pairs, and/or save it to a csv file for use later on.

## What does `take_attendance()` actually do?

It takes in:
- A full list of enrolled students (your full class list from __Step 1__)
- A list of which students showed up (present students, indexed by position their on the roster)
- An optional session label (e.g., `"CourseX_Week1"`), but recommended for recording purposes.

It returns:
- A __table__ showing who was present or absent in that session. 

And optionally:
- Saves that table to a `.csv` file so you can keep track of attendance over multiple weeks/sessions. 

## Basic usage

You have your master class list from Step 1.

Now suppose four students show up to Week 1: Nicola, John, Beth, and Audrey. These students are in rows 1, 2, 4, and 5 of the data frame.

Here’s how you record that attendance:

```{r}
# Load in the usheR package from your library
# library(usheR)

attendance_week1 <- take_attendance(
  full_class = class_dataframe,
  present_students = c(1, 2, 4, 5),  # the row numbers of students who are present
  session_id = "CourseX_Week1" # this label will show up in the attendance table, as well as the saved csv file (if you choose to save - next part)
)
```

This gives you a data frame (tibble) like this:

```{r echo = FALSE}
attendance_week1
```

This clearly shows you which students were present and absent in Week 1 of Course X.

### Saving attendance to a file

If you want to save this attendance to a `.csv` file, for example, to build up a full term's worth of attendance records, just add the `file_path` argument to the function:

```{r}
take_attendance(
  full_class = class_dataframe,
  present_students = c(1, 2, 4, 5),
  session_id = "CourseX_Week1",
  file_path = "CourseX_attendance_log.csv"
)
```

This __creates__ a file named `CourseX_attendance_log.csv`, in which the file will be saved in your __working directory__.

To check your working directory:

```{r}
getwd()
```

To change your working directory, use `setwd("your/folder/path")` or set it in RStudio using the Session > Set Working Directory menu.

### Adding more sessions to the same file

If you want to add each week’s attendance to the same file, use the `append = TRUE` option:

```{r}
attendance_week2 <- take_attendance(
  full_class = class_dataframe,
  present_students = c(2, 3, 4, 6),
  session_id = "CourseX_Week2",
  file_path = "CourseX_attendance_log.csv",
  append = TRUE)
attendance_week2
```

This will add Week 2’s attendance above Week 1’s, keeping everything in one neat file. This is very useful for reporting attendance at the end of the academic year, so it is recommended to append at the end of every session/week (_apart from the first week of course, where there is nothing to append to_). 

### How do I know the row numbers of each student?

Run your master class list name (in this example, run the line below) in the RStudio Console to print the full class list with row numbers, or view the data frame from the environment:

```{r}
class_dataframe
```

The numbers on the left (1, 2, 3, etc.) are the indices you’ll use in `present_students =`.

If you’re working from a printed attendance sheet or Zoom/Teams student list, just match up names to their row number in your data frame.

### Common mistakes to avoid

| Mistake | Explanation | Fix |
| --------| ----------- | --- |
| Forgetting the `name` column   | `full_class` must be a __data frame with a `name` column__ | Use `data.frame(name = class_list)` |
| Using names instead of numbers | `present_students` must be row numbers, __not__ names | Use the row index (e.g., `1`, `2`) not `"Nicola"` | 
| Not giving a `session_id`| One will be generated for you (e.g., with date/time), but it’s better to label it | Provide a string like `"CourseX_Week1"` |


# Step 3: generate students pairs 

Once you have taken attendance for a session (Step 2), the next step is to __form pairs or small groups__ of the students who are present. This is done using the __`student_pairs()`__ function.

This function uses a smart pairing algorithm that tries to __avoid repeating pairs from previous weeks__, so that students work with someone new each time.

You can use it:
- For any number of present students
- With different group sizes (e.g., pairs, trios, groups of 4)
- With or without pairing history from previous sessions (pairing history is needed for subsequent sessions/weeks so no duplicate pairs/groups are given)
- With or without saving to file (need to save the pairs history for subsequent sessions/weeks so no duplicate pairs/groups are given)

## What does `student_pairs()` actually do?

It takes in:
- The attendance data for that session/week (from `take_attendance()` - Step 2)

It optionally takes in:
- A file path (to save pairings and load past history)
- Group size (e.g., 2 for pairs, 3 for trios, and so on)

It returns:
- A table showing which students were grouped together for that session/week
_(along with week/session and group number)_

It also:
- Tries to minimise repeated groupings

## Basic usage

Taking your attendance output from `take_attendance()` (Step 2), use __`student_pairs()`__ to generate groups from the present students.

```{r}
pairings_week1 <- student_pairs(attendance = attendance_week1,
                                group_size = 2, # Group size can be changed to any number
                                seed = 100) # Ensures same output every time
```

This will return a `tibble` (table) with 3 columns:

```{r}
pairings_week1
```

Each group is a row. The `~~` in the pairing column separates the student names in each group.

### Saving to a file

If you want to save these pairings to a `.csv` file (strongly recommended), just add a `file_path`: 

```{r}
student_pairs(attendance = attendance_week1, 
              group_size = 2,
              file_path = "CourseX_week1_pairs.csv",
              seed = 100) # Ensures same output every time
```

This creates a file in your current working directory called `CourseX_week1_pairs.csv`, with the same columns: `week`, `group`, and `pairing`.

If this file already exists, the pairing history will be loaded from it and used to minimise repeated pairs.
The new pairs will append to the file, including all pairings so far from each week. 

### Changing the group size
By default, `student_pairs()` creates pairs (`group_size = 2`). But you can change this:

```{r}
student_pairs(attendance = attendance_week1, 
              group_size = 3,
              seed = 100) # Ensures same output every time
```

This will try to group students into groups of 3 instead of pairs.

__Note__: If the number of present students doesn’t divide evenly (e.g., 7 students in groups of 3), the leftover student is always added to the first group, so that no one is missed out. 

### Avoiding repeat pairings automatically

If you pass a `file_path` to `student_pairs()`, the function will automatically read in previous pairings from that file and try to avoid repeating any past groups.

You don’t need to manually pass in history - just keep saving to the same file each week!

### Common mistakes to avoid

Forgetting to pass pairing history
* You may get repeated pairs from week to week. So, remember to add the file_path from the first week to ensure the previous weeks pairs can be taken into account.

Not saving
* The result is in memory unless you specify file_path. So, use `file_path = "pairs.csv"` to save to use pairs next session/week.

# Step 4: repeat across sessions

Now that you have generated pairs for the first session/week, you can continue the process week-by-week, or session-by-session.

The key idea is to:
1. __Take attendance__ each session.
2. __Generate new pairs__, while using __previous pairings__ to avoid repeating groupings.
3. __Save__ each week’s attendance and pairs for a full record (optional but recommended).

This helps ensure that, over time, students are paired with as many different classmates as possible — creating a fair and rotating group system.

## Example: Week 2

Let’s say four different students show up in Week 2: John, Keith, Audrey, and Hesham — rows __2, 3, 5, and 6__.

We record their attendance:

```{r}
attendance_week2 <- take_attendance(
  full_class = class_dataframe,
  present_students = c(2, 3, 5, 6),
  session_id = "Week_2")
attendance_week2
```

Now generate new student pairs, __but tell the algorithm who was paired in Week 1__:

```{r }
pairings_week2 <- student_pairs(
  attendance = attendance_week2,
  #file_path = "pairings_week1.csv", # THIS IS COMMENTED OUT AS WE HAVENT SAVED THE PAIRINGS_WEEK1, BUT THIS IS REQUIRED FOR SUBSEQUENT WEEKS PAIRINGS
  seed = 100) # Ensures same output every time
pairings_week2
```

This will do its best to create __new pairs__, avoiding combinations seen in Week 1.

If you save the output, this also iteratively adds the new groups for each week too, so you only have to pass `student_pairs()` the pairs csv from last week/session, as it will contain all the groups from all previous weeks/sessions. 

# Example: multiple weeks (realistic usage)

Let’s walk through a realistic multi-week teaching scenario, using real names from the built-in `USJudgeRatings` dataset in R as our class list, which includes real names of Judges from the US Superior Court. This simulates how you might use the __`usheR`__ package throughout a course, including saving files, tracking attendance over time, and avoiding repeat pairings.

This example shows how to:
- Use `file_path` to save data
- Use `append = TRUE` to __add new weeks__ to the same CSV
- Rotate group sizes

__Don’t want to save files to your computer?__  
Just remove the `file_path` and `append` arguments — the functions will still work in-memory.


## Scenario

You’re running a __Law course__ with 43 students. Each week:
- You take attendance
- You form small groups of 2–3 students
- You want to ensure __students work with someone new__ each week
- You want to __save__ everything to CSV so you can review it later


```{r}
# Full class roster
class_list <- data.frame(name = rownames(USJudgeRatings))
class_list
```

##### Week 1: pairs
``` {r }
# Take attendance for Week 1
attendance_w1 <- take_attendance(full_class = class_list,
                                 present_students = c(1:6, 7, 9, 13:20), 
                                 session_id = "LawCourse_Week_1",
                                 file_path = "LawCourse_attendance.csv")
attendance_w1

# Form pairs and save for Week 1
student_pairs_w1 <- student_pairs(attendance = attendance_w1,
                                  group_size = 2,
                                  file_path = "LawCourse_pairs.csv",
                                  seed = 100) # Ensures same output every time
student_pairs_w1
```

#### Week 2: Groups of 3 (with history)

``` {r }
# Take attendance and APPEND to same file for Week 2
attendance_w2 <- take_attendance(class_list, 
                                 c(2:7, 8:11, 28),
                                 session_id = "LawCourse_Week_2",
                                 file_path = "LawCourse_attendance.csv",
                                 append = TRUE)
attendance_w2

# Form trios and avoid repeating Week 1 pairs by loading past pairs from file
student_pairs_w2 <- student_pairs(attendance_w2,
                                  group_size = 3,
                                  file_path = "LawCourse_pairs.csv",
                                  seed = 100) # Ensures same output every time
student_pairs_w2
```

##### Week 3: More pairs (keep building history)
``` {r }
# Take attendance again for Week 3
attendance_w3 <- take_attendance(class_list, 
                                 c(1, 4, 5, 8, 10, 15:30), 
                                 session_id = "LawCourse_Week_3",
                                 file_path = "LawCourse_attendance.csv",
                                 append = TRUE)
attendance_w3

# Form new pairs and avoid repeating any past groups automatically from file
student_pairs_w3 <- student_pairs(attendance_w3, 
                                  group_size = 2,
                                  file_path = "LawCourse_pairs.csv",
                                  seed = 100) # Ensures same output every time
student_pairs_w3
```

### Key Notes

__Save as you go__
Each use of `take_attendance()` and `student_pairs()` saves to the same files — so your full course data is stored in:
- LawCourse_attendance.csv
- LawCourse_pairs.csv

__Use `append = TRUE`__
This ensures new attendance records are added to your file, not overwritten.

__Mix group sizes__
You can change group_size every week - try it!

# What You’ll Have at the End

* A complete attendance log across weeks

* A record of all pairings, with each session labeled

* CSV files you can import later into Excel, R, or a dashboard

* Fair groupings that rotate automatically
